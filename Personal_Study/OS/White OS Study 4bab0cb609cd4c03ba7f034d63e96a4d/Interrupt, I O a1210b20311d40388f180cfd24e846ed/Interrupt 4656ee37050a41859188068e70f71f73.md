# Interrupt

![Untitled](Interrupt%204656ee37050a41859188068e70f71f73/Untitled.png)

# Definition

- 인터럽트는 컴퓨터에 연결된 장치나 컴퓨터 내의 프로그램에서 발생하는 신호다.
- 인터럽트는 서비스나 현재 프로세스를 일시적으로 중지하거나 종료한다.
- 대부분의 I/O 장치에는 ISR(Interrupt Service Rutine)이라는 버스 제어 라인이 있으며 이를 통해 서비스나 프로세스를 중지 및 종료하는 작업을 제어한다.
- 인터럽트 신호는 계획될 수도(프로그램에 의한 요청), 계획되지 않을 수도(시스템에서 실행 중인 프로그램과 관련되지 않은 이벤트로 인해 발생) 있다.
- 오늘날 거의 모든 컴퓨팅 시스템은 인터럽트 기반으로 이루어져 있다. 컴퓨팅 시스템은 프로그램의 컴퓨터 명령어 목록을 따르고 끝에 도달하거나 인터럽트 신호를 감지할 때까지 명령어를 실행한다.
- 인터럽트 신호가 감지되면 컴퓨터는 현재 프로그램 실행을 재개하거나 다른 프로그램 실행을 시작한다. 두 경우 모두 다음 작업을 결정하는 동안 작업을 중지해야 한다.
- 장치 프로세서는 인터럽트를 처리할 때 IRQ(인터럽트 요청, Interrupt ReQuest)이 인식되었음을 신호를 보내는 장치에 알린다. 그 뒤 장치는 IRQ 신호 전송을 중지한다.
- OS에는 일반적으로 인터럽트의 우선 순위를 지정하고 둘 이상이 처리 대기 중인 경우 대queue에 저장하는 Interrupt handler 코드가 포함되어 있다. 또한, 제어할 다음 프로그램을 결정하는 scheduler 프로그램도 있다.
- 인터럽트가 발생하면 관련 서비스가 즉시 시작되지 않을 수 있으며, 인터럽트가 발생한 시간과 ISR 실행이 시작되는 시간 사이의 간격을 인터럽트 대기 시간이라고 한다.
- 일반적으로 내부 장치 및 소프트웨어 프로그램에서 발생하는 인터럽트 신호를 소프트웨어 인터럽트, 외부 장치 및 I/O 장치에서 발생하는 인터럽트 신호와 CPU에 대한 인터럽트를 하드웨어 인터럽트라고 한다.

# Type of Interrupt

### Hadware Interrupt

- 하드웨어 인터럽트는 OS의 주의가 필요함을 나타내는 외부 하드웨어 장치의 전자 신호다. 예시로는 키보드를 누르거나 마우스를 움직이는 행위가 있다. 이러한 예시에서 프로세서는 해당 순간에 마우스 위치나 키 입력을 읽기 위해 중지해야 한다.
- 하드웨어 인터럽트에서는 모든 장치가 IRL(Interrupt Request Line)에 연결된다. 일반적으로 하드웨어 IRQ에는 이를 특정 장치와 연결하는 값이 있다. 이를 통해 프로세서는 IRQ를 높여 어떤 장치가 서비스를 요청하는지 확인한 다음 그에 따라 서비스를 제공할 수 있다.
    1. Maskable interrupts
        - CPU의 명령에 의해 비 활성화되거나 무시될 수 있는 하드웨어 인터럽트
        - 프로세서에서 내부 인터럽트 마스크 레지스터는 하드웨어 요청을 선택적으로 활성화 및 비 활성화한다. 마스크 비트가 설정되면 인터럽트가 활성화되며 마스크 비트가 지워지면 비 활성화된다. 마스크의 영향을 받는 신호는 마스크 가능한 인터럽트다.
    2. Non-maskable interrupts
        - CPU 명령에 의해 비 활성화되거나 무시될 수 없는 하드웨어 인터럽트
        - 경우에 따라 인터럽트 마스크를 비 활성화할 수 없으므로 일부 인터럽트 신호에 영향을 미치지 않는다.
        - 마스크할 수 없는 인터럽트이며 일반적으로 무시할 수 없는 우선순위가 높은 이벤트다.
    3. Spurious interrupts
        - phantom interrupt, ghost interrupt로도 알려진 인터럽트로, 가짜(Spurious) 인터럽트는 소스를 찾을 수 없는 하드웨어 인터럽트 유형이다. 가짜 인터럽트는 시스템이 오작동 하는지 식별하기 어려우며, ISR이 가짜 인터럽트 가능성을 고려하지 않으면 시스템 교착 상태가 발생할 수 있다.
        - 레벨 감지 프로세서 입력에 연결된 유선 OR 인터럽트 회로에서 문제가 되는 경향이 있다.

### Software Interrupt

- 소프트웨어 인터럽트는 응용 프로그램이 종료되거나 OS의 특정 서비스를 요청할 때 발생한다.
- 일반적으로 프로세서는 특정 조건이 충족되면 특수 명령을 실행하여 소프트웨어 인터럽트를 요청한다. 이 명령어는 인터럽트를 호출하고 서브루틴 호출과 같은 기능을 한다.
- 소프트웨어 인터럽트는 시스템이 장치 드라이버와 상호 작용하거나 프로그램이 OS 서비스를 요청할 때 일반적으로 사용된다.
- 어떤 경우에는 소프트웨어 인터럽트가 의도한 것이 아닌 프로그램 실행 오류로 인해 예기치 않게 발생할 수 있다. 이를 exceptions나 traps라고 한다.

# Polling

- 폴링(Polling)은 컴퓨터 시스템의 마이크로 컨트롤러가 모든 장치의 상태를 지속적으로 확인하는 지속적인 모니터링 상태이다.
- 즉, 기본적으로 CPU가 I/O 장치를 서비스하는 프로토콜이다.
- 인터럽트와 폴링 모두에서 CPU는 수행 중인 작업을 일시 중지하고 필수 작업을 실행하도록 한다.
- IRQ 비트를 만난 첫 번째 장치가 먼저 서비스를 받고 해당 장치를 서비스하기 위해 적절한 ISR(Insterrupt Service Routine)이 호출된다.
- 마이크로 컨트롤러는 폴링에 모든 처리 시간을 사용하기에 동시 작업을 수행할 수 없다. 또한 모든 장치의 IRQ 비트를 조사하는 데 많은 시간이 낭비된다.
- 결과적으로 CPU 시간의 대부분이 불필요한 폴링에 낭비되게 되므로 비효율적인 방법이다.
- 인터럽트를 사용함으로서 컨트롤러가 장치 상태를 정기적으로 모니터링 할 필요가 없어지며, 인터럽트가 발생할 때만 응답하도록 할 수 있다.
- 즉 인터럽트가 발생하면 컨트롤러에 서비스가 필요하다는 알림이 전달된다.

# Difference between interrupt and polling

| Interrupt | Polling |
| --- | --- |
| 인터럽트는 CPU에 주의가 필요하다는 알림을 보내는 프로세스다. | 폴링은 CPU가 장치의 상태를 지속적으로 확인하여 CPU의 주의가 필요한지 확인하는 프로세스다. |
| 하드웨어 메커니즘으로 간주된다. | 프로토콜이다. |
| 인터럽트 핸들러는 장치를 서비스하고 장치와 함께 작동한다 | CPU가 장치에 서비스를 제공한다. |
| 인터럽트 요청 라인으로 장치에 서비스가 필요함을 나타낸다. | 명령 준비 비트로 장치에 서비스가 필요함을 나타낸다. |
| CPU는 장치에 서비스가 필요할 때만 사용된다. | CPU는 장치에 서비스가 필요한지 기다리고 확인해야 한다 |
| 인터럽트는 CPU 사이클을 절약한다 | 폴링은 많은 CPU 주기를 낭비한다 |
| 인터럽트는 언제든지 발생할 수 있다. | CPU는 일정한 시간 간격으로 장치를 폴링한다 |
| 장치가 CPU를 자주 중단하면 비효율적이게 된다. | CPU가 서비스할 준비가 된 장치를 거의 찾지 못하면 폴링이 비효율적이 된다.  |

# IRQ(Interrupt Request)

- 인터럽트 요구 라인(Interrupt Request Line)을 의미한다. 컴퓨터 프로세스에서 전송되는 인터럽트의 라인이다.
- IRQ는 여러 장치가 컴퓨터에 연결되어 있는 경우 중요하다.
- 컴퓨터에 연결된 모든 장치는 고유한 데이터 회선은 채널을 통해 IRQ와 통신한다. 여기에는 디스크 드라이브 컨트롤러, 사운드 카드, 프린터, 키보드 및 마우스가 포함된다.
- IRQ가 참조될 때마다 IRQ 번호라고도 하는 채널 번호와 함께 발생한다. 각 장치에는 고유한 IRQ 번호가 할당된다.
- 장치에 입력을 제공하거나 특정 작업을 시작하려면 고유한 IRQ 번호가 필요하다. IRQ 번호를 통해 다양한 장치에 우선순위를 할당하며 적절한 CPU 응답을 촉진한다.
- IRQ 번호가 낮을수록 입력이나 작업의 필요성이 더 중요해진다. 다음은 PC에 대한 일반적인 IRQ 할당
    
    
    | IRQ# | 장치 |
    | --- | --- |
    | 0 | 시스템 타이머 |
    | 1 | 키보드(PS/2) |
    | 2 | IRQ 9의 캐스케이드 |
    | 3 | COM 포트 2, 4 |
    | 4 | COM 포트 1, 3 |
    | 5 | 병렬(프린터) 포트 2 또는 사운드 카드 |
    | 6 | 플로피 드라이브 컨트롤러 |
    | 7 | 병렬(프린터) 포트 1 |
    | 8 | 실시간 시계 |
    | 9 | 동영상 |
    | 10 | Open |
    | 11 | Open |
    | 12 | 마우스(PS/2) |
    | 13 | 보조 프로세서 |
    | 14 | 기본 IDE 컨트롤러(하드 드라이브) |
    | 15 | 보조 IDE 컨트롤러(하드 드라이브) |

# ISR(Interrupt Service Routine)

- 인터럽트 서비스 루틴, 인터럽트 핸들러를 의미한다. 하드웨어 장치의 인터럽트 요청에 의해 호출되는 소프트웨어 프로세스다.
- 인터럽트가 걸리고 정해진 내용을 처리하는 과정이 인터럽트 서비스, 만들어진 내용(함수)를 인터럽트 서비스 루틴이라고 한다.
- ISR은 인터럽트를 검사하고, 처리하는 방법을 결정하고, 실행하고, 논리적인 인터럽트 값을 CPU로 반환하여 활성 프로세스를 중단한다. ISR이 완료되면 프로세스가 재개된다.
- ISR은 데이터를 CPU 레지스터나 하드웨어 포트에서 메모리 버퍼로 이동할 수 있지만 일반적으로 IST(Interrupt Service Thread)라고 하는 전용 인터럽트 스레드(또는 작업)를 사용하여 필요한 대부분의 처리를 수행한다.
- 모든 인터럽트에는 실행할 ISR이 하나만 있으며 이 Context에서 실행되는 코드는 차단될 수 없기에 ISR의 실행은 원자적이다. 프로세서가 인터럽트를 수신하면 제어가 ISR로 전환된다.
- ISR 실행이 완료된 후 제어는 중단된 프로그램으로 돌아간다. 기술적으로 인수는 ISR에 전달되지 않으며 아무것도 반환하지 않는다.

# Mechanism of Interrupt Handling

![Untitled](Interrupt%204656ee37050a41859188068e70f71f73/Untitled%201.png)

- 인터럽트의 기본은 I/O 장치를 누를 때마다 CPU가 확인하는 것이 아닌, I/O 장치가 CPU를 중단시키는 것에 있다.
- I/O 장치는 $\overline{INTR}$ 신호를 CPU에 보내 인터럽트를 요청한다
- CPU는 $\overline{INTR}$ 신호를 수신할 때마다 현재 명령어의 실행을 완료한 다음 ISR을 실행한다. CPU가 준비되면 INTA 라인을 통해 승인 신호를 보낸다
- ISR이 실행되고 CPU는 기본 프로그램으로 돌아간다
- I/O 장치는 실행 후 $\overline{INTR}$ 신호를 끈다.